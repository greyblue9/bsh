
public static ZipFile ab2zip(String path, String outZip) { InputStream is = new BufferedInputStream(new FileInputStream(new File(path))); is.mark(64); byte[] b = null; is.read(b = new byte[64], 0, 64); is.reset(); int i = 0, pos = -1; while (++i <= 4) { pos = ArrayUtils.indexOf(b, (byte) (int) '\n', pos+1); }; is.skip(pos + 1); ByteArrayInputStream hdr = new ByteArrayInputStream(new byte[] { 0x1F, 0x8B, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00 }); InputStream composite = new edu.rice.cs.util.JoinInputStream(hdr, is); TarFile tf = new TarFile(composite); tf.maxContentSize = Integer.MAX_VALUE; Map zm = RealArrayMap.toMap(tf.getEntries().entrySet().select("""m => if (m.getKey() == null) throw new RuntimeException(); return Pair.of(m.getKey(), ((TarEntry)m.getValue()).getBytes())""")); ZipFile zf = writeZip(new File(outZip), zm); return zf; }

