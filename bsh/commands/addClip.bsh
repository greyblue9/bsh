public static File addClip(String text) { String summary = Pattern.compile("([^a-zA-Z0-9_.-]+)").matcher(text).replaceAll("__"); String fileName = String.format("clip_%s__%s", org.apache.commons.lang3.time.DateFormatUtils.format(System.currentTimeMillis(), "MM-dd-yyy", TimeZone.getTimeZone("EST5EDT")), summary.length() > 80? summary.substring(0,80): summary); File outFile = new File(new File("/external_sd/clips"), fileName); if (outFile.getParentFile().exists() || outFile.getParentFile().mkdirs()) { File f = outFile; File newFile = f; int nonce = -1; while (++nonce < 1000) { String suffix = String.format(".%03d", nonce); String newFile = new File(f.getParentFile(), nonce > 0? f.getName().concat(suffix): f.getName()); if (newFile.exists()) { continue; } else { FileUtils.writeStringToFile(newFile, text.concat("\n")); if (newFile.length() >= text.length()+1) return newFile; return null; }; }; throw new RuntimeException("ran out of nonce values: " + newFile.getPath());  }; return null; };
