
public static String fmtExpr(String expr) { StringBuilder sb = new StringBuilder("public class A {\n  \n  public void a() {\n    ").append(expr.replaceAll("^((( *)?bsh )?% )", "").replaceAll("\"\"\"(.+?)\"\"\"", "(\"\" /* multi-line string\n$1\n    */ + \"\")")).append("\n  }\n}\n"); String escaped = formatJava(sb.toString()); String unescaped = escaped.replaceAll("\\(\"\"/\\*\\*\nmulti-line string\n(.+?)\n\\*/\n *\\+ \"\"\\)", "\"\"\"$1\"\"\""); return StringUtils.substringBeforeLast(StringUtils.substringAfter(unescaped, "public void a() {\n    "), "\n  }\n}\n").replaceAll("(^|\n)    ", "$1").replaceAll("\n( *);\n", "\n$1");  }

