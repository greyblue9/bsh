import java.util.Map.Entry;



public static android.content.Intent parseIntent(String urldata) { List<String> parts = new ArrayList(Arrays.asList(urldata.split("&").print())); Map dm = new TreeMap(); Matcher intMchr = Pattern.compile("^-?([1-9][0-9]*)$").matcher(""), doubleMchr = Pattern.compile("^-?(?:0|[1-9][0-9]*)(\\.[0-9]*|)$").matcher(""); for (String part: parts) { int eqpos = part.indexOf('='); String name = part.substring(0, eqpos), data = part.substring(eqpos+1); dm.put(name, data);  if (intMchr.reset(data).find()) { data = Integer.parseInt(data, 10); } else if (doubleMchr.reset(data).find()) { data = Double.parseDouble(data, 10); } else if (data.length() > 4 && data.charAt(0) == '{' && data.charAt(data.length()-1) == '}') { String subdata = data.substring(1, data.length()-1); int colonpos = subdata.indexOf(':'); if (colonpos != -1) { String typeName = subdata.substring(0, colonpos), initdata = subdata.substring(colonpos+1); Class cls = DexVisitor.classForName(typeName); if (cls != null) { Object jsondata = initdata.charAt(0) == '['? new org.json.JSONArray(initdata): new org.json.JSONObject(initdata); System.err.printf("class: %s\njsondata: %s\n", cls, jsondata); Object _data = (jsondata instanceof org.json.JSONArray)? Reflect.getfldval(jsondata, "values"): Reflect.getfldval(jsondata, "nameValuePairs"); System.err.printf("_data = %s\n", Debug.ToString(_data)); try { data = Reflect.newInstance(cls, _data); System.err.printf("Success! data = %s\n", Debug.ToString(data)); } catch (Throwable e) { Throwable cause = getRootCause(e); e.printStackTrace(); }; } } }; if (dm.get(name) != data) dm.put(name, data); };         android.content.Intent in = (dm.containsKey("action"))? new android.content.Intent(dm["action"]): new android.content.Intent(); if (dm.containsKey("data") && dm.containsKey("type")) { in.setDataAndType(android.net.Uri.parse(dm["data"]), dm["type"]); } else if (dm.containsKey("data")) { in.setData(android.net.Uri.parse(dm["data"])); }; if (dm.containsKey("flags")) { in.setFlags(dm["flags"].intValue()); }; for (Entry e: dm.entrySet()) { if (e.getKey().equals("data") || e.getKey().equals("type") || e.getKey().equals("flags")) continue; String name = e.getKey(); Object value = e.getValue(); in.putExtra(name, value); }; return in; }



