
public static List<Map> query(String dbPath, String sql) { Map intToTypeMap = ConstUtil.constantMap(DatabaseUtil.class, "FIELD_TYPE_", -1); Object db = DatabaseUtil.open(copyDatabase(dbPath).getAbsolutePath()); Object q = DatabaseUtil.newQuery(db, sql); Object c = DatabaseUtil.openQuery(db, q); String[] _columnNames = c.getColumnNames(); int numCols = _columnNames.length; Map nameTypeMap = new RealArrayMap(numCols), nameIndexMap = new RealArrayMap(numCols), columnInfoByName = new RealArrayMap(numCols), columnInfo = new TreeMap(); int prefixLen = ("FIELD_TYPE_").length();  for (int i=0; i<numCols; ++i) { int columnTypeId = c.getWindow().getType(0, i); String columnTypeName = intToTypeMap.get(Integer.valueOf(columnTypeId)).substring(prefixLen).toLowerCase(); String columnName = _columnNames[i]; nameTypeMap.put(columnName, columnTypeName); nameIndexMap.put(columnName, Integer.valueOf(i)); columnInfo.put(Integer.valueOf(i), Pair.of(columnName, columnTypeName)); columnInfoByName.put(columnName, Pair.of(Integer.valueOf(i), columnTypeName)); }; List<String> columnNames = Arrays.asList(_columnNames); List<Map> rs = DatabaseUtil.getResult(c); File dbFile = new File(DatabaseUtil.getConnection(DatabaseUtil.getSession(db)).mConfiguration.path); boolean isCopy = Pattern.compile(String.format("^%s/.tmp_", Pattern.quote(System.getProperty("java.io.tmpdir")))).matcher(dbFile.getAbsolutePath()).find(); DatabaseUtil.close(db); if (isCopy) dbFile.delete(); return rs; };

